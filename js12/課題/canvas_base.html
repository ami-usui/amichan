<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>ğŸ¨</title>
    
</head>

<body>
    <section>
        <h1>Canvas ğŸ–¼</h1>
        <nav>
            <!-- ç·šã®è‰²ã‚’å¤‰æ›´ã™ã‚‹ã‚«ãƒ©ãƒ¼ãƒ”ãƒƒã‚«ãƒ¼HTMLè¦ç´ [id="color"] -->
            <input type="color" id="color"> color</input>
            <!-- ç·šã®å¤ªã•ã‚’å¤‰æ›´ã™ã‚‹ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼HTMLè¦ç´ [id="range"] -->
            <input type="range" id="range" min="1" max="50" value="10"> range</input>
            <!-- ã‚¯ãƒªã‚¢ãƒœã‚¿ãƒ³ -->
            <button id="clear_btn"> clear</button>
            <button id="eraser_btn"> eraser </button>
        </nav>
        <br>
        <canvas id="drowarea" width="800" height="400" style="border:5px solid #80b3dd;"></canvas>
    </section>


    <script src="js/jquery-2.1.3.min.js"></script>
    <link rel="stylesheet" href="css/js10.css">
    <script>
        //åˆæœŸåŒ–(å¤‰æ•°letã§å®£è¨€)
        let canvas_mouse_event = false; //ã‚¹ã‚¤ãƒƒãƒ [ true=ç·šã‚’å¼•ã, false=ç·šã¯å¼•ã‹ãªã„ ]  ï¼Šï¼Šï¼Š
        let oldX = 0; //ï¼‘ã¤å‰ã®åº§æ¨™ã‚’ä»£å…¥ã™ã‚‹ãŸã‚ã®å¤‰æ•°
        let oldY = 0; //ï¼‘ã¤å‰ã®åº§æ¨™ã‚’ä»£å…¥ã™ã‚‹ãŸã‚ã®å¤‰æ•°
        let bold_line = "range"; //ãƒ©ã‚¤ãƒ³ã®å¤ªã•ã‚’ã“ã“ã§æŒ‡å®š[ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼å€¤ã‚’ã“ã“ã«å…¥ã‚Œã‚‹]
        let color = "color"; //ãƒ©ã‚¤ãƒ³ã®è‰²ã‚’ã“ã“ã§æŒ‡å®š[ã‚«ãƒ©ãƒ¼ãƒ”ãƒƒã‚«ãƒ¼å€¤ã‚’ã“ã“ã«å…¥ã‚Œã‚‹]

        //------------------------------------------------
        const can = $("#drowarea")[0]; //CanvasElement
        const ctx = can.getContext("2d"); //æç”»ã™ã‚‹ãŸã‚ã®æº–å‚™ï¼
        //------------------------------------------------
        //ä¸Š2ã¤ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è¨˜è¿°ã—ã¾ã™ã€‚

        // mousedownï¼šãƒ•ãƒ©ã‚°ã‚’True
        // //-----------------------------------------------
        // oldX = e.offsetX;       //MOUSEDOWNã—ãŸXæ¨ªåº§æ¨™å–å¾—
        // oldY = e.offsetY; //MOUSEDOWN Yé«˜ã•åº§æ¨™å–å¾—
        // canvas_mouse_event=true;
        //-----------------------------------------------
        //ä¸Š5ã¤ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è¨˜è¿°ã—ã¾ã™ã€‚
        $(can).on("mousedown", function(e){
            oldX = e.offsetX; //MOUSEDOWNã—ãŸXæ¨ªåº§æ¨™å–å¾—
            oldY = e.offsetY; //MOUSEDOWN Yé«˜ã•åº§æ¨™å–å¾—
            canvas_mouse_event=true; // ã‚¹ã‚¤ãƒƒãƒã‚’å…¥ã‚Œã‚‹
        });

        //mousemoveï¼šãƒ•ãƒ©ã‚°ãŒTrueã ã£ãŸã‚‰æã â€»eï¼šã‚¤ãƒ™ãƒ³ãƒˆå¼•æ•°å–å¾—
        //----------------------------------------------

        $(can).on("mousemove", function(e){
            if(canvas_mouse_event==true){
                const px = e.offsetX;
                const py = e.offsetY;
                ctx.strokeStyle = color;
                ctx.lineWidth = bold_line;
                ctx.beginPath();            //åˆæœŸåŒ–
                ctx.lineJoin= "round";      //â—
                ctx.lineCap = "round";      //â—
                ctx.moveTo(oldX, oldY);     //é–‹å§‹
                ctx.lineTo(px, py);         //çµ‚äº†
                ctx.stroke();               //ç·šã‚’æã
                oldX = px;                  //æ–°ã—ã„åº§æ¨™ã‚’å¤ã„åº§æ¨™ã«å…¥ã‚Œæ›¿ãˆã‚‹
                oldY = py;                  //æ–°ã—ã„åº§æ¨™ã‚’å¤ã„åº§æ¨™ã«å…¥ã‚Œæ›¿ãˆã‚‹
            }
        });

        //mouseupï¼šãƒ•ãƒ©ã‚°ã‚’false
        //------------------------------------------------
        //    canvas_mouse_event=false;
        //------------------------------------------------
        $(can).on("mouseup", function(){
            canvas_mouse_event=false;
        });

        $(can).on("mouseout", function(){
            canvas_mouse_event=false;
        });
        
        function dragStart(event) {
            // ã“ã‚Œã‹ã‚‰æ–°ã—ã„ç·šã‚’æ›¸ãå§‹ã‚ã‚‹ã“ã¨ã‚’å®£è¨€ã™ã‚‹
            // ä¸€é€£ã®ç·šã‚’æ›¸ãå‡¦ç†ãŒçµ‚äº†ã—ãŸã‚‰dragEndé–¢æ•°å†…ã®closePathã§çµ‚äº†ã‚’å®£è¨€ã™ã‚‹
            context.beginPath();
            isDrag = true;
        }
        function dragEnd(event) {
            // ç·šã‚’æ›¸ãå‡¦ç†ã®çµ‚äº†ã‚’å®£è¨€ã™ã‚‹
            context.closePath();
            isDrag = false;
            // æç”»ä¸­ã«è¨˜éŒ²ã—ã¦ã„ãŸå€¤ã‚’ãƒªã‚»ãƒƒãƒˆã™ã‚‹
            lastPosition.x = null;
            lastPosition.y = null;
        }

        //#clear_btnï¼šã‚¯ãƒªã‚¢ãƒ¼ãƒœã‚¿ãƒ³Action
        //-----------------------------------------------------------------
        //    ctx.beginPath();
        //    ctx.clearRect(0, 0, can.width, can.height);
        //-----------------------------------------------------------------
        $("#clear_btn").on("click", function(){
           ctx.beginPath();
           ctx.clearRect(0, 0, can.width, can.height);
        });
        $("#eraser_btn").on("click", function(){
            color = '#ececec';
        });
        //colorã‚¯ãƒªãƒƒã‚¯
        $("#color").on("change",function(){
            color = $(this).val();
        });
        //rangeã‚¯ãƒªãƒƒã‚¯æ™‚
        $("#range").on("change",function(){
            bold_line = $(this).val();
        });

    </script>
</body>

</html>